<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>All-in-One Store</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background: linear-gradient(135deg, #f7f7f7 60%, #e0f7fa 100%);
        }
        .header {
            position: fixed;
            top: 0; left: 0; right: 0;
            height: 60px;
            background: linear-gradient(135deg, #2a8f2a 0%, #43e97b 100%);
            color: #fff;
            display: flex;
            align-items: center;
            padding-left: 220px;
            font-size: 1.7em;
            font-weight: bold;
            letter-spacing: 2px;
            z-index: 200;
            box-shadow: 0 4px 20px rgba(42,143,42,0.15);
            gap: 1em;
            backdrop-filter: blur(10px);
        }
        .header-logo {
            width: 38px;
            height: 38px;
            margin-right: 0.7em;
            border-radius: 50%;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.10);
        }
        .sidebar {
            position: fixed;
            top: 0; left: 0; bottom: 0;
            width: 200px;
            background: #fff;
            border-right: 1px solid #e0e0e0;
            box-shadow: 2px 0 8px rgba(0,0,0,0.03);
            padding-top: 60px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        .sidebar .nav-title {
            margin: 2em 0 1em 0;
            font-size: 1.1em;
            color: #2a8f2a;
            font-weight: bold;
        }
        .sidebar .nav-link {
            margin: 0.5em 0;
            color: #333;
            text-decoration: none;
            font-size: 1em;
            transition: color 0.2s;
            border-radius: 5px;
            padding: 0.3em 1em;
        }
        .sidebar .nav-link:hover {
            color: #2a8f2a;
            background: #e0f7fa;
        }
        .main-content {
            margin-left: 200px;
            padding: 80px 2vw 2vw 2vw;
            max-width: 1200px;
            width: 100vw;
            box-sizing: border-box;
        }
        h1, h2 { color: #333; }
        .catalog-section { margin-bottom: 2em; }
        .catalog-title {
            font-size: 1.5em;
            margin-bottom: 0.2em;
            color: #fff;
            background: linear-gradient(90deg, #2a8f2a 60%, #43e97b 100%);
            padding: 0.3em 1.2em;
            border-radius: 12px;
            font-weight: 700;
            letter-spacing: 1px;
            box-shadow: 0 2px 8px rgba(42,143,42,0.08);
            display: inline-block;
            text-shadow: 0 2px 8px rgba(42,143,42,0.10);
        }
        .category-divider {
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, #2a8f2a 60%, #43e97b 100%);
            border: none;
            margin: 0.5em 0 1.2em 0;
            border-radius: 2px;
            opacity: 0.18;
        }
        .catalog { display: flex; gap: 1.2em; flex-wrap: wrap; }
        .product {
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.10);
            padding: 1.2em 1em 1.5em 1em;
            width: 210px;
            min-width: 160px;
            flex: 1 1 210px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            text-align: center;
            transition: box-shadow 0.2s, transform 0.2s;
            position: relative;
            margin-bottom: 0.5em;
        }
        .product:hover {
            box-shadow: 0 12px 32px rgba(42,143,42,0.16);
            transform: translateY(-6px) scale(1.04);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .product {
            animation: fadeInUp 0.6s ease-out;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .product-card {
            background: inherit;
            border-radius: inherit;
            box-shadow: none;
            padding: 0;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .product img { width: 80px; height: 80px; object-fit: contain; margin-bottom: 0.7em; filter: drop-shadow(0 2px 4px #e0e0e0); }
        .product-info { width: 100%; display: flex; flex-direction: column; align-items: center; }
        .product-title {
            font-weight: bold;
            margin-bottom: 0.3em;
            font-size: 1.18em;
            letter-spacing: 0.7px;
            color: #222;
            font-family: 'Segoe UI', 'Arial', sans-serif;
            text-shadow: 0 1px 4px #e0e0e0;
        }
        .product-price { color: #2a8f2a; margin-bottom: 0.7em; font-size: 1.08em; font-weight: 500; }
        .order-btn {
            background: linear-gradient(90deg, #2a8f2a 60%, #43e97b 100%);
            color: #fff;
            border: none;
            border-radius: 6px;
            padding: 0.5em 1.2em;
            cursor: pointer;
            font-size: 1.05em;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(42,143,42,0.10);
            transition: background 0.2s, box-shadow 0.2s, transform 0.1s;
            display: flex;
            align-items: center;
            gap: 0.5em;
        }
        .order-btn:hover { background: linear-gradient(90deg, #217a21 60%, #43e97b 100%); box-shadow: 0 6px 18px rgba(42,143,42,0.18); transform: scale(1.04); }
        .order-list { margin-top: 2em; }
        .order { background: #fff; border-radius: 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.07); padding: 1em; margin-bottom: 1em; display: flex; align-items: center; cursor: pointer; min-width: 0; transition: box-shadow 0.2s; }
        .order:hover { box-shadow: 0 8px 32px rgba(42,143,42,0.13); }
        .order img { width: 40px; height: 40px; object-fit: contain; margin-right: 1em; flex-shrink: 0; filter: drop-shadow(0 2px 4px #e0e0e0); }
        .order > div { min-width: 0; flex: 1; }
        .pay-btn {
            background: #0074d9;
            color: #fff;
            border: none;
            border-radius: 5px;
            padding: 0.4em 1em;
            cursor: pointer;
            font-size: 0.95em;
            margin-left: 1em;
            box-shadow: 0 2px 8px rgba(0,116,217,0.08);
            transition: background 0.2s, box-shadow 0.2s;
        }
        .pay-btn:hover { background: #005fa3; box-shadow: 0 4px 16px rgba(0,116,217,0.13); }
        .paid { color: green; font-weight: bold; margin-left: 1em; }
        .unpaid { color: red; font-weight: bold; }
        #paymentModal, #orderDetailsModal, #confirmModal {
            display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); z-index: 1000;
        }
        .modal-content {
            background:#fff; margin:10vh auto; padding:2em; width:320px; position:relative; border-radius: 16px; box-shadow: 0 4px 32px rgba(0,0,0,0.13);
        }
        #paymentModal h3, #orderDetailsModal h3, #confirmModal h3 { margin-top: 0; }
        #paymentStatus { margin-top: 1em; }
        #toast {
            display: none;
            position: fixed;
            bottom: 2em;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: #fff;
            border-radius: 8px;
            padding: 1em 2em;
            z-index: 3000;
            font-size: 1.1em;
            opacity: 0.95;
        }
        #spinner {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 4000;
        }
        .spinner {
            border: 6px solid #f3f3f3;
            border-top: 6px solid #2a8f2a;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5em; }
        .show-btn { background: #eee; border: none; border-radius: 5px; padding: 0.2em 0.8em; cursor: pointer; font-size: 0.95em; }
        .show-btn:hover { background: #ddd; }
        @media (max-width: 1200px) {
            .main-content { max-width: 100vw; }
        }
        @media (max-width: 900px) {
            .main-content { max-width: 100vw; }
        }
        @media (max-width: 700px) {
            .sidebar { display: none; }
            .header { padding-left: 1em; }
            .main-content { margin-left: 0; padding: 80px 1em 1em 1em; }
        }
        @media (max-width: 600px) {
            .catalog { flex-direction: column; gap: 1em; }
            .product { width: 100%; }
            .modal-content { width: 90vw; }
            .order { flex-direction: column; align-items: flex-start; }
        }
        h2#products {
            font-size: 2.1em;
            color: #2a8f2a;
            font-weight: 800;
            letter-spacing: 1.5px;
            margin-bottom: 0.2em;
            text-shadow: 0 2px 8px rgba(42,143,42,0.10);
        }
        h2#orders {
            font-size: 1.7em;
            color: #0074d9;
            font-weight: 700;
            letter-spacing: 1px;
            margin-top: 2em;
            margin-bottom: 0.5em;
        }
    </style>
</head>
<body>
    <div id="loginModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.7); z-index: 2000; backdrop-filter: blur(5px);">
        <div class="modal-content" style="width:380px; background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%); border: 1px solid #e9ecef; box-shadow: 0 20px 60px rgba(0,0,0,0.15);">
            <div style="text-align: center; margin-bottom: 1.5em;">
                <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #2a8f2a 0%, #43e97b 100%); border-radius: 50%; margin: 0 auto 1em; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.8em; font-weight: bold; box-shadow: 0 4px 15px rgba(42,143,42,0.3);">A</div>
                <h3 style="margin: 0; color: #2a8f2a; font-size: 1.5em; font-weight: 600;">Welcome Back</h3>
                <p style="margin: 0.5em 0 0 0; color: #6c757d; font-size: 0.95em;">Sign in to your account</p>
            </div>
            <form id="loginForm">
                <div style="margin-bottom: 1.2em;">
                    <label style="display: block; margin-bottom: 0.5em; color: #495057; font-weight: 500;">Username</label>
                    <input type="text" id="loginUsername" required style="width: 100%; padding: 0.8em 1em; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1em; transition: border-color 0.3s; box-sizing: border-box;" placeholder="Enter your username">
                </div>
                <div style="margin-bottom: 1.5em;">
                    <label style="display: block; margin-bottom: 0.5em; color: #495057; font-weight: 500;">Password</label>
                    <input type="password" id="loginPassword" required style="width: 100%; padding: 0.8em 1em; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1em; transition: border-color 0.3s; box-sizing: border-box;" placeholder="Enter your password">
                </div>
                <button type="submit" style="width: 100%; background: linear-gradient(135deg, #2a8f2a 0%, #43e97b 100%); color: white; border: none; border-radius: 8px; padding: 0.9em; font-size: 1.1em; font-weight: 600; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; box-shadow: 0 4px 15px rgba(42,143,42,0.3);">Sign In</button>
            </form>
            <div id="loginError" style="color: #dc3545; margin-top: 1em; padding: 0.8em; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 6px; display: none;"></div>
            <div style="text-align: center; margin-top: 1.5em; padding-top: 1.5em; border-top: 1px solid #e9ecef;">
                <p style="margin: 0; color: #6c757d; font-size: 0.9em;">
                    <strong>Demo Credentials:</strong><br>
                    Admin: <code>admin/admin</code><br>
                    User: <code>user/user</code>
                </p>
            </div>
        </div>
    </div>
    <div class="header">
        <span class="header-logo" style="background:#fff;color:#2a8f2a;font-size:1.7em;font-weight:bold;display:flex;align-items:center;justify-content:center;width:38px;height:38px;border-radius:50%;box-shadow:0 2px 8px rgba(0,0,0,0.10);">A</span>
        <div style="display: flex; align-items: center; gap: 0.5em;">
            <span style="font-weight: 600;">All-in-One Store</span>
            <span style="font-size: 0.8em; opacity: 0.8; background: rgba(255,255,255,0.2); padding: 0.2em 0.6em; border-radius: 12px;">v2.0</span>
        </div>
        <div id="userInfo" style="margin-left:auto; margin-right:2em; font-size:1em; font-weight:500; display: flex; align-items: center; gap: 1em;">
            <span id="userDisplay" style="background: rgba(255,255,255,0.1); padding: 0.5em 1em; border-radius: 20px; display: none;"></span>
            <button id="profileBtn" style="display:none; background:rgba(255,255,255,0.1); color:#fff; border:1px solid rgba(255,255,255,0.3); border-radius:50%; width:36px; height:36px; font-size:1.2em; cursor:pointer; transition: all 0.2s; display:flex; align-items:center; justify-content:center;" title="Profile">👤</button>
            <button id="logoutBtn" style="display:none; background:rgba(255,255,255,0.1); color:#fff; border:1px solid rgba(255,255,255,0.3); border-radius:6px; padding:0.4em 1em; font-size:0.9em; cursor:pointer; transition: all 0.2s;">Logout</button>
        </div>
    </div>
            <div class="sidebar">
        <div class="nav-title">Menu</div>
        <a class="nav-link" href="#products">Products</a>
        <a class="nav-link" href="#orders">Orders</a>
        <a class="nav-link" id="usersMenuLink" href="#users" style="display:none;">Users</a>
        <a class="nav-link" id="profileMenuLink" href="#profile" style="display:none;">Profile</a>
        <!-- Add more links here if needed -->
    </div>
    <div class="main-content">
        <div style="display: flex; align-items: center; gap: 1em; margin-bottom: 1.5em;">
            <input id="searchBar" type="text" placeholder="Search products..." style="flex:1; max-width: 350px; padding: 0.6em 1em; border-radius: 8px; border: 1px solid #ccc; font-size: 1em; box-shadow: 0 1px 4px #e0e0e0;">
        </div>
        <div class="section-header" style="margin-bottom: 0.5em;">
            <h2 id="products">Products</h2>
            <button id="addProductBtn" title="Add Product" style="background:#2a8f2a;color:#fff;border:none;border-radius:50%;width:36px;height:36px;font-size:1.5em;cursor:pointer;display:flex;align-items:center;justify-content:center;">+</button>
        </div>
        <div class="catalog-section">
            <div class="catalog-title">Food</div>
            <div class="category-divider"></div>
            <div class="catalog" id="food-catalog"></div>
        </div>
        <div class="catalog-section">
            <div class="catalog-title">Beers</div>
            <div class="category-divider"></div>
            <div class="catalog" id="beers-catalog"></div>
        </div>
        <div class="catalog-section">
            <div class="catalog-title">Whiskey</div>
            <div class="category-divider"></div>
            <div class="catalog" id="whiskey-catalog"></div>
        </div>

        <h2 id="orders">Your Orders</h2>
        <div class="order-list">
            <div class="section-header">
                <span>Paid (<span id="paid-count">0</span>)</span>
                <button class="show-btn" id="show-paid-btn">Show All</button>
            </div>
            <div id="paid-orders"></div>
            <div class="section-header">
                <span>Unpaid (<span id="unpaid-count">0</span>)</span>
                <button class="show-btn" id="show-unpaid-btn">Show All</button>
            </div>
            <div id="unpaid-orders"></div>
        </div>

        <div id="usersSection" style="display:none; margin-bottom:2em;">
            <div class="catalog-title" style="background:#0074d9;">Users</div>
            <div class="category-divider" style="background:#0074d9;"></div>
            <div style="display:flex; gap:1em; margin-bottom:1.5em;">
                <button id="showAddUserBtn" class="order-btn" style="background:#0074d9;">Add User</button>
                <button id="showListUsersBtn" class="order-btn" style="background:#2a8f2a;">List Users</button>
                <button id="backToStoreBtn" style="background:#eee; color:#2a8f2a; border:none; border-radius:6px; padding:0.4em 1em; font-size:1em; cursor:pointer; margin-left:auto;">Back to Store</button>
            </div>
            <div id="addUserSection" style="display:none;">
                <form id="addUserForm" style="max-width:350px; margin-bottom:1em;">
                    <label>Username:<br><input type="text" id="newUsername" required style="width:100%"></label><br><br>
                    <label>Password:<br><input type="password" id="newPassword" required style="width:100%"></label><br><br>
                    <label>User Type:<br>
                        <select id="newUserType" required style="width:100%">
                            <option value="USER">User</option>
                            <option value="ADMIN">Admin</option>
                        </select>
                    </label><br><br>
                    <button type="submit" class="order-btn">Add User</button>
                </form>
                <div id="addUserStatus" style="margin-bottom:1em;"></div>
            </div>
            <div id="listUsersSection" style="display:none;">
                <table id="usersTable" style="width:100%; border-collapse:collapse; background:#fff; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.06); overflow:hidden;">
                    <thead style="background:#e0f7fa;">
                        <tr>
                            <th style="padding:0.7em 1em; text-align:left;">Username</th>
                            <th style="padding:0.7em 1em; text-align:left;">User Type</th>
                            <th style="padding:0.7em 1em; text-align:left;">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Profile Management Section -->
        <div id="profileSection" style="display:none; margin-bottom:2em;">
            <div class="catalog-title" style="background:#ff6b35;">Profile Management</div>
            <div class="category-divider" style="background:#ff6b35;"></div>
            <div style="display:flex; gap:1em; margin-bottom:1.5em;">
                <button id="backToStoreFromProfileBtn" style="background:#eee; color:#2a8f2a; border:none; border-radius:6px; padding:0.4em 1em; font-size:1em; cursor:pointer; margin-left:auto;">Back to Store</button>
            </div>
            <div id="profileForm" style="max-width:500px; background:#fff; padding:2em; border-radius:12px; box-shadow:0 4px 16px rgba(0,0,0,0.1);">
                <h3 style="margin-top:0; color:#ff6b35; font-size:1.5em; margin-bottom:1.5em;">Edit Your Profile</h3>
                <form id="updateProfileForm">
                    <div style="margin-bottom:1.5em;">
                        <label style="display:block; margin-bottom:0.5em; color:#495057; font-weight:500;">Username</label>
                        <input type="text" id="profileUsername" required style="width:100%; padding:0.8em 1em; border:2px solid #e9ecef; border-radius:8px; font-size:1em; transition:border-color 0.3s; box-sizing:border-box;">
                    </div>
                    <div style="margin-bottom:1.5em;">
                        <label style="display:block; margin-bottom:0.5em; color:#495057; font-weight:500;">Email</label>
                        <input type="email" id="profileEmail" required style="width:100%; padding:0.8em 1em; border:2px solid #e9ecef; border-radius:8px; font-size:1em; transition:border-color 0.3s; box-sizing:border-box;">
                    </div>
                    <div style="margin-bottom:1.5em;">
                        <label style="display:block; margin-bottom:0.5em; color:#495057; font-weight:500;">Phone Number</label>
                        <input type="tel" id="profilePhone" style="width:100%; padding:0.8em 1em; border:2px solid #e9ecef; border-radius:8px; font-size:1em; transition:border-color 0.3s; box-sizing:border-box;">
                    </div>
                    <div style="margin-bottom:1.5em;">
                        <label style="display:block; margin-bottom:0.5em; color:#495057; font-weight:500;">New Password (leave blank to keep current)</label>
                        <input type="password" id="profilePassword" style="width:100%; padding:0.8em 1em; border:2px solid #e9ecef; border-radius:8px; font-size:1em; transition:border-color 0.3s; box-sizing:border-box;">
                    </div>
                    <button type="submit" style="width:100%; background:linear-gradient(135deg, #ff6b35 0%, #f7931e 100%); color:white; border:none; border-radius:8px; padding:0.9em; font-size:1.1em; font-weight:600; cursor:pointer; transition:transform 0.2s, box-shadow 0.2s; box-shadow:0 4px 15px rgba(255,107,53,0.3);">Update Profile</button>
                </form>
                <div id="profileStatus" style="margin-top:1em; padding:0.8em; border-radius:6px; display:none;"></div>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div id="paymentModal">
        <div class="modal-content">
            <h3>Pay for Order</h3>
            <form id="paymentForm">
                <input type="hidden" id="payOrderId">
                <label>Amount: <input type="number" id="payAmount" required step="any"></label><br><br>
                <button type="submit" class="pay-btn">Pay</button>
                <button type="button" onclick="closeModal()">Cancel</button>
            </form>
            <div id="paymentStatus"></div>
        </div>
    </div>

    <!-- Order Details Modal -->
    <div id="orderDetailsModal">
        <div class="modal-content">
            <h3>Order Details</h3>
            <div id="orderDetailsContent"></div>
            <button onclick="closeOrderDetails()">Close</button>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal">
        <div class="modal-content">
            <h3 id="confirmTitle">Confirm</h3>
            <div id="confirmMessage"></div>
            <button id="confirmYes">Yes</button>
            <button onclick="closeConfirm()">No</button>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div id="addProductModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); z-index: 1000;">
        <div class="modal-content">
            <h3>Add Product</h3>
            <form id="addProductForm">
                <label>Name:<br><input type="text" id="productName" required style="width:100%"></label><br><br>
                <label>Category:<br>
                    <select id="productCategory" required style="width:100%">
                        <option value="Beer">Beer</option>
                        <option value="Whiskey">Whiskey</option>
                        <option value="Food">Food</option>
                    </select>
                </label><br><br>
                <label>Price:<br><input type="number" id="productPrice" required step="any" min="0" style="width:100%"></label><br><br>
                <label>Image URL:<br><input type="text" id="productImageUrl" style="width:100%" placeholder="(optional)"></label><br><br>
                <label>Description:<br><textarea id="productDescription" rows="2" style="width:100%" placeholder="(optional)"></textarea></label><br><br>
                <button type="submit" class="order-btn">Add</button>
                <button type="button" onclick="closeAddProductModal()">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast"></div>

    <!-- Loading Spinner -->
    <div id="spinner"><div class="spinner"></div></div>

    <script>
    // Beer and whiskey stickers (reliable emoji PNGs)
    const BEER_STICKER = "https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f37a.png";
    const WHISKEY_STICKER = "https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f943.png";
    const FOOD_STICKER = "https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f35a.png";

    // Product data by category
    const beers = [
        { title: "Budweiser", price: 4.99 },
        { title: "Miller Lite", price: 4.49 },
        { title: "Corona", price: 5.49 },
        { title: "Modelo", price: 5.99 },
    ];
    const whiskey = [
        { title: "Jameson", price: 7.99 },
        { title: "Johnny Walker Double Black", price: 12.99 },
        { title: "Glenfiddich", price: 14.99 },
        { title: "Glenmorangie", price: 13.99 },
    ];

    // Map product to sticker
    const productImages = {};
    beers.forEach(p => { productImages[p.title] = BEER_STICKER; });
    whiskey.forEach(p => { productImages[p.title] = WHISKEY_STICKER; });

    const orderApi = 'http://localhost:8081/orders';
    const paymentApi = 'http://localhost:8080/payments';
    const productsApi = 'http://localhost:8082/products';

    // Track paid orders in the frontend
    let paidOrderIds = [];
    let showAllPaid = false;
    let showAllUnpaid = false;
    let ordersCache = [];
    let products = [];

    const SAMPLE_BEERS = [
        { name: "Budweiser", category: "Beer", price: 4.99, imageUrl: BEER_STICKER },
        { name: "Miller Lite", category: "Beer", price: 4.49, imageUrl: BEER_STICKER },
        { name: "Corona", category: "Beer", price: 5.49, imageUrl: BEER_STICKER },
        { name: "Heineken", category: "Beer", price: 5.99, imageUrl: BEER_STICKER }
    ];
    const SAMPLE_WHISKEYS = [
        { name: "Jameson", category: "Whiskey", price: 7.99, imageUrl: WHISKEY_STICKER },
        { name: "Jack Daniel's", category: "Whiskey", price: 8.99, imageUrl: WHISKEY_STICKER },
        { name: "Glenfiddich", category: "Whiskey", price: 14.99, imageUrl: WHISKEY_STICKER },
        { name: "Glenmorangie", category: "Whiskey", price: 13.99, imageUrl: WHISKEY_STICKER }
    ];
    const SAMPLE_FOODS = [
        { name: "Pizza", category: "Food", price: 9.99, imageUrl: FOOD_STICKER },
        { name: "Burger", category: "Food", price: 7.99, imageUrl: FOOD_STICKER },
        { name: "Sushi", category: "Food", price: 12.99, imageUrl: FOOD_STICKER },
        { name: "Salad", category: "Food", price: 6.99, imageUrl: FOOD_STICKER }
    ];

    // Toast notification
    function showToast(message, isError = false) {
        const toast = document.getElementById('toast');
        toast.innerText = message;
        toast.style.background = isError ? '#d9534f' : '#333';
        toast.style.display = 'block';
        setTimeout(() => {
            toast.style.display = 'none';
        }, 1800);
    }

    // Loading spinner
    function showSpinner() {
        document.getElementById('spinner').style.display = 'block';
    }
    function hideSpinner() {
        document.getElementById('spinner').style.display = 'none';
    }

    // Confirmation dialog
    function showConfirm(message, onYes) {
        document.getElementById('confirmMessage').innerText = message;
        document.getElementById('confirmModal').style.display = 'block';
        document.getElementById('confirmYes').onclick = function() {
            document.getElementById('confirmModal').style.display = 'none';
            onYes();
        };
    }
    function closeConfirm() {
        document.getElementById('confirmModal').style.display = 'none';
    }

    // Add search functionality
    let searchTerm = '';
    document.getElementById('searchBar').addEventListener('input', function(e) {
        searchTerm = e.target.value.trim().toLowerCase();
        renderProducts();
    });

    // Fetch products from backend
    async function fetchProducts() {
        showSpinner();
        try {
            const res = await fetch(productsApi);
            products = await res.json();
            // Remove any sample products from backend results to avoid duplicates
            products = products.filter(p =>
                !(p.category === 'Beer' && SAMPLE_BEERS.some(s => s.name === p.name)) &&
                !(p.category === 'Whiskey' && SAMPLE_WHISKEYS.some(s => s.name === p.name)) &&
                !(p.category === 'Food' && SAMPLE_FOODS.some(s => s.name === p.name))
            );
        } catch (err) {
            // If backend fails, just use empty products
            products = [];
        } finally {
            hideSpinner();
            renderProducts();
        }
    }

    // Render products by category
    function renderProducts() {
        const beersCatalog = document.getElementById('beers-catalog');
        beersCatalog.innerHTML = '';
        const whiskeyCatalog = document.getElementById('whiskey-catalog');
        whiskeyCatalog.innerHTML = '';
        const foodCatalog = document.getElementById('food-catalog');
        foodCatalog.innerHTML = '';
        // Always show sample beers/whiskeys/foods first
        const beerProducts = [
            ...SAMPLE_BEERS.filter(p => p.name.toLowerCase().includes(searchTerm)),
            ...products.filter(p => p.category === 'Beer' && p.name.toLowerCase().includes(searchTerm))
        ];
        const whiskeyProducts = [
            ...SAMPLE_WHISKEYS.filter(p => p.name.toLowerCase().includes(searchTerm)),
            ...products.filter(p => p.category === 'Whiskey' && p.name.toLowerCase().includes(searchTerm))
        ];
        const foodProducts = [
            ...SAMPLE_FOODS.filter(p => p.name.toLowerCase().includes(searchTerm)),
            ...products.filter(p => p.category === 'Food' && p.name.toLowerCase().includes(searchTerm))
        ];
        foodProducts.forEach((p) => {
            const div = document.createElement('div');
            div.className = 'product product-card';
            const imgSrc = !p.imageUrl || !p.imageUrl.trim() || p.imageUrl === 'null' ? FOOD_STICKER : p.imageUrl;
            div.innerHTML = `
                <img src="${imgSrc}" alt="Food Sticker">
                <div class="product-info">
                    <div class="product-title">${p.name}</div>
                    <div class="product-price">$${Number(p.price).toFixed(2)}</div>
                    <button class="order-btn" onclick="confirmOrder('${p.name}', ${p.price})"><span style="font-size:1.1em;">🛒</span> Order</button>
                </div>
            `;
            foodCatalog.appendChild(div);
        });
        beerProducts.forEach((p) => {
            const div = document.createElement('div');
            div.className = 'product product-card';
            const imgSrc = !p.imageUrl || !p.imageUrl.trim() || p.imageUrl === 'null' ? BEER_STICKER : p.imageUrl;
            div.innerHTML = `
                <img src="${imgSrc}" alt="Beer Sticker">
                <div class="product-info">
                    <div class="product-title">${p.name}</div>
                    <div class="product-price">$${Number(p.price).toFixed(2)}</div>
                    <button class="order-btn" onclick="confirmOrder('${p.name}', ${p.price})"><span style="font-size:1.1em;">🛒</span> Order</button>
                </div>
            `;
            beersCatalog.appendChild(div);
        });
        whiskeyProducts.forEach((p) => {
            const div = document.createElement('div');
            div.className = 'product product-card';
            const imgSrc = !p.imageUrl || !p.imageUrl.trim() || p.imageUrl === 'null' ? WHISKEY_STICKER : p.imageUrl;
            div.innerHTML = `
                <img src="${imgSrc}" alt="Whiskey Sticker">
                <div class="product-info">
                    <div class="product-title">${p.name}</div>
                    <div class="product-price">$${Number(p.price).toFixed(2)}</div>
                    <button class="order-btn" onclick="confirmOrder('${p.name}', ${p.price})"><span style="font-size:1.1em;">🛒</span> Order</button>
                </div>
            `;
            whiskeyCatalog.appendChild(div);
        });
    }

    // Confirm before placing order
    window.confirmOrder = (description, amount) => {
        showConfirm(`Place order for ${description} ($${amount.toFixed(2)})?`, () => placeOrder(description, amount));
    };

    // Place order from catalog
    window.placeOrder = async (description, amount) => {
        showSpinner();
        try {
            const res = await fetch(orderApi, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ description, amount })
            });
            if (!res.ok) throw new Error('Order API error');
            showToast('Order placed!');
            fetchOrders();
        } catch (err) {
            showToast('Order failed! Backend may be down.', true);
        } finally {
            hideSpinner();
        }
    };

    // Fetch and render orders
    async function fetchOrders() {
        showSpinner();
        try {
            const res = await fetch(orderApi);
            const orders = await res.json();
            ordersCache = orders;
            // Paid/Unpaid split
            const paidOrders = orders.filter(order => paidOrderIds.includes(order.id));
            let unpaidOrders = orders.filter(order => !paidOrderIds.includes(order.id));
            unpaidOrders = unpaidOrders.slice().sort((a, b) => b.id - a.id); // latest first
            document.getElementById('paid-count').innerText = paidOrders.length;
            document.getElementById('unpaid-count').innerText = unpaidOrders.length;
            renderOrderSection('paid-orders', paidOrders, true, showAllPaid);
            renderOrderSection('unpaid-orders', unpaidOrders, false, showAllUnpaid);
        } catch (err) {
            showToast('Failed to fetch orders!', true);
        } finally {
            hideSpinner();
        }
    }

    function renderOrderSection(containerId, orders, isPaid, showAll) {
        const container = document.getElementById(containerId);
        container.innerHTML = '';
        const toShow = showAll ? orders : orders.slice(0, 3);
        for (const order of toShow) {
            let imgSrc = productImages[order.description] || BEER_STICKER;
            const div = document.createElement('div');
            div.className = 'order';
            div.onclick = () => showOrderDetails(order);
            div.innerHTML = `
                <img src="${imgSrc}" alt="${order.description}">
                <div>
                    <b>Order #${order.id}</b><br>
                    <span>${order.description}</span><br>
                    <span>Amount: $${order.amount}</span><br>
                    ${isPaid ? '<span class="paid">Paid</span>' : `<button class=\"pay-btn\" onclick=\"event.stopPropagation();openPayModal(${order.id}, ${order.amount})\">Pay</button>`}
                </div>
            `;
            container.appendChild(div);
        }
        // If there are more than 3, show/hide the Show All/Less button
        const btnId = isPaid ? 'show-paid-btn' : 'show-unpaid-btn';
        const btn = document.getElementById(btnId);
        if (orders.length > 3) {
            btn.style.display = '';
            btn.innerText = showAll ? 'Show Less' : 'Show All';
        } else {
            btn.style.display = 'none';
        }
    }

    document.getElementById('show-paid-btn').onclick = function() {
        showAllPaid = !showAllPaid;
        fetchOrders();
    };
    document.getElementById('show-unpaid-btn').onclick = function() {
        showAllUnpaid = !showAllUnpaid;
        fetchOrders();
    };

    // Order details modal
    function showOrderDetails(order) {
        const content = document.getElementById('orderDetailsContent');
        content.innerHTML = `
            <b>Order #${order.id}</b><br>
            <span>Product: ${order.description}</span><br>
            <span>Amount: $${order.amount}</span><br>
            <span>Status: ${paidOrderIds.includes(order.id) ? '<span class=\'paid\'>Paid</span>' : '<span class=\'unpaid\'>Unpaid</span>'}</span><br>
        `;
        document.getElementById('orderDetailsModal').style.display = 'block';
    }
    function closeOrderDetails() {
        document.getElementById('orderDetailsModal').style.display = 'none';
    }
    window.closeOrderDetails = closeOrderDetails;

    // Payment modal logic
    function openPayModal(orderId, amount) {
        showConfirm('Proceed to payment?', () => {
            document.getElementById('payOrderId').value = orderId;
            document.getElementById('payAmount').value = Number(amount);
            document.getElementById('paymentStatus').innerText = '';
            document.getElementById('paymentModal').style.display = 'block';
        });
    }
    window.openPayModal = openPayModal;
    function closeModal() {
        document.getElementById('paymentModal').style.display = 'none';
    }
    window.closeModal = closeModal;

    document.getElementById('paymentForm').onsubmit = async (e) => {
        e.preventDefault();
        const orderId = document.getElementById('payOrderId').value;
        const amount = document.getElementById('payAmount').value;
        showSpinner();
        try {
            const res = await fetch(paymentApi, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ orderId, amount, status: 'PAID' })
            });
            if (res.ok) {
                paidOrderIds.push(Number(orderId));
                showToast('Payment successful!');
                setTimeout(() => {
                    closeModal();
                    fetchOrders();
                }, 1200);
            } else {
                showToast('Payment failed! Backend may be down.', true);
                setTimeout(() => {
                    closeModal();
                }, 1200);
            }
        } catch (err) {
            showToast('Payment failed! Backend may be down.', true);
            setTimeout(() => {
                closeModal();
            }, 1200);
        } finally {
            hideSpinner();
        }
    };

    // Add Product Modal logic
    document.getElementById('addProductBtn').onclick = function() {
        document.getElementById('addProductModal').style.display = 'block';
    };
    function closeAddProductModal() {
        document.getElementById('addProductModal').style.display = 'none';
        document.getElementById('addProductForm').reset();
    }
    window.closeAddProductModal = closeAddProductModal;
    document.getElementById('addProductForm').onsubmit = async function(e) {
        e.preventDefault();
        showSpinner();
        const name = document.getElementById('productName').value;
        const category = document.getElementById('productCategory').value;
        const price = document.getElementById('productPrice').value;
        let imageUrl = document.getElementById('productImageUrl').value;
        let description = document.getElementById('productDescription').value;
        if (!imageUrl.trim()) {
            if (category === 'Beer') imageUrl = BEER_STICKER;
            else if (category === 'Whiskey') imageUrl = WHISKEY_STICKER;
            else if (category === 'Food') imageUrl = FOOD_STICKER;
        }
        // description is optional, can be empty
        try {
            const res = await fetch(productsApi, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, category, price, imageUrl, description })
            });
            if (res.ok) {
                showToast('Product added successfully!');
                closeAddProductModal();
                fetchProducts();
            } else {
                showToast('Failed to add product!', true);
            }
        } catch (err) {
            showToast('Failed to add product!', true);
        } finally {
            hideSpinner();
        }
    };

    // --- Login/Logout/session logic ---
    const usersApi = 'http://localhost:8082/users';
    let currentUser = null;
    function showLoginModal() {
        document.getElementById('loginModal').style.display = 'block';
        document.getElementById('loginError').innerText = '';
    }
    function hideLoginModal() {
        document.getElementById('loginModal').style.display = 'none';
        document.getElementById('loginForm').reset();
    }

    document.getElementById('logoutBtn').onclick = function() {
        currentUser = null;
        localStorage.removeItem('user');
        updateUserUI();
        showLoginModal();
    };
    document.getElementById('loginForm').onsubmit = async function(e) {
        e.preventDefault();
        const username = document.getElementById('loginUsername').value;
        const password = document.getElementById('loginPassword').value;
        const loginError = document.getElementById('loginError');
        const submitBtn = e.target.querySelector('button[type="submit"]');
        
        // Show loading state
        submitBtn.innerHTML = '<span style="display:inline-block;width:16px;height:16px;border:2px solid #fff;border-top:2px solid transparent;border-radius:50%;animation:spin 1s linear infinite;"></span> Signing In...';
        submitBtn.disabled = true;
        loginError.style.display = 'none';
        
        try {
            const res = await fetch(usersApi + '/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            });
            
            if (res.ok) {
                const user = await res.json();
                currentUser = user;
                localStorage.setItem('user', JSON.stringify(user));
                updateUserUI();
                hideLoginModal();
                showToast(`Welcome back, ${user.username}! 👋`);
            } else {
                loginError.style.display = 'block';
                loginError.innerHTML = '❌ Invalid username or password. Please try again.';
            }
        } catch (err) {
            loginError.style.display = 'block';
            loginError.innerHTML = '⚠️ Connection failed. Please check if the backend services are running.';
        } finally {
            // Reset button state
            submitBtn.innerHTML = 'Sign In';
            submitBtn.disabled = false;
        }
    };
    // On load, check for user in localStorage
    window.onload = function() {
        const userStr = localStorage.getItem('user');
        if (userStr) {
            currentUser = JSON.parse(userStr);
            updateUserUI();
        } else {
            showLoginModal();
        }
    };

    // Add user form logic (admin only)
    document.getElementById('addUserForm').onsubmit = async function(e) {
        e.preventDefault();
        const username = document.getElementById('newUsername').value;
        const password = document.getElementById('newPassword').value;
        const userType = document.getElementById('newUserType').value;
        const statusDiv = document.getElementById('addUserStatus');
        statusDiv.innerText = '';
        try {
            const res = await fetch(usersApi + '/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password, userType })
            });
            if (res.ok) {
                statusDiv.style.color = '#2a8f2a';
                statusDiv.innerText = 'User added successfully!';
                document.getElementById('addUserForm').reset();
                showListUsersSection();
            } else {
                statusDiv.style.color = '#d9534f';
                statusDiv.innerText = 'Failed to add user.';
            }
        } catch (err) {
            statusDiv.style.color = '#d9534f';
            statusDiv.innerText = 'Failed to add user. Backend may be down.';
        }
    };

    // Users section logic (admin only)
    async function fetchUsers() {
        try {
            const res = await fetch(usersApi);
            if (res.ok) {
                const users = await res.json();
                renderUsersTable(users);
            }
        } catch (err) {}
    }
    function renderUsersTable(users) {
        const tbody = document.getElementById('usersTableBody');
        tbody.innerHTML = '';
        users.forEach(u => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td style='padding:0.6em 1em;'>${u.username}</td><td style='padding:0.6em 1em;'>${u.userType}</td><td style='padding:0.6em 1em;'><button class='order-btn' style='background:#d9534f;' onclick='deleteUser(${u.id})'>Delete</button></td>`;
            tbody.appendChild(tr);
        });
    }
    async function deleteUser(userId) {
        if (!confirm('Are you sure you want to delete this user?')) return;
        try {
            const res = await fetch(usersApi + '/' + userId, { method: 'DELETE' });
            if (res.ok) {
                fetchUsers();
            } else {
                alert('Failed to delete user.');
            }
        } catch (err) {
            alert('Failed to delete user. Backend may be down.');
        }
    }
    document.getElementById('usersMenuLink').onclick = function() {
        // Hide all product/order sections
        const productsSections = [
            document.getElementById('food-catalog').parentElement,
            document.getElementById('beers-catalog').parentElement,
            document.getElementById('whiskey-catalog').parentElement,
            document.getElementById('orders'),
            document.querySelector('.order-list')
        ];
        productsSections.forEach(sec => { if (sec) sec.style.display = 'none'; });
        document.getElementById('usersSection').style.display = '';
        document.getElementById('showAddUserBtn').style.display = '';
        document.getElementById('showListUsersBtn').style.display = '';
        document.getElementById('addUserSection').style.display = '';
        document.getElementById('listUsersSection').style.display = 'none';
        showAddUserSection();
        window.location.hash = '#users';
    };
    document.getElementById('backToStoreBtn').onclick = function() {
        document.getElementById('usersSection').style.display = 'none';
        // Show all product/order sections
        const productsSections = [
            document.getElementById('food-catalog').parentElement,
            document.getElementById('beers-catalog').parentElement,
            document.getElementById('whiskey-catalog').parentElement,
            document.getElementById('orders'),
            document.querySelector('.order-list')
        ];
        productsSections.forEach(sec => { if (sec) sec.style.display = ''; });
        window.location.hash = '#products';
    };
    document.getElementById('showAddUserBtn').onclick = showAddUserSection;
    document.getElementById('showListUsersBtn').onclick = showListUsersSection;
    function showAddUserSection() {
        document.getElementById('addUserSection').style.display = '';
        document.getElementById('listUsersSection').style.display = 'none';
        document.getElementById('addUserStatus').innerText = '';
    }
    function showListUsersSection() {
        document.getElementById('addUserSection').style.display = 'none';
        document.getElementById('listUsersSection').style.display = '';
        fetchUsers();
    }

    // Profile Management Functions
    function updateUserUI() {
        const userDisplay = document.getElementById('userDisplay');
        const logoutBtn = document.getElementById('logoutBtn');
        const profileBtn = document.getElementById('profileBtn');
        const profileMenuLink = document.getElementById('profileMenuLink');
        const addProductBtn = document.getElementById('addProductBtn');
        const usersMenuLink = document.getElementById('usersMenuLink');
        
        if (currentUser) {
            const userTypeIcon = currentUser.userType === 'ADMIN' ? '👑' : '👤';
            userDisplay.innerHTML = `${userTypeIcon} ${currentUser.username} <span style="font-size:0.8em; opacity:0.8;">(${currentUser.userType})</span>`;
            userDisplay.style.display = '';
            logoutBtn.style.display = '';
            profileBtn.style.display = '';
            profileMenuLink.style.display = '';
            
            if (currentUser.userType === 'ADMIN') {
                addProductBtn.style.display = '';
                usersMenuLink.style.display = '';
                document.getElementById('showAddUserBtn').style.display = '';
                document.getElementById('showListUsersBtn').style.display = '';
                document.getElementById('addUserSection').style.display = '';
                document.getElementById('listUsersSection').style.display = 'none';
            } else {
                addProductBtn.style.display = 'none';
                usersMenuLink.style.display = 'none';
                document.getElementById('showAddUserBtn').style.display = 'none';
                document.getElementById('showListUsersBtn').style.display = 'none';
                document.getElementById('addUserSection').style.display = 'none';
                document.getElementById('listUsersSection').style.display = 'none';
            }
        } else {
            userDisplay.style.display = 'none';
            logoutBtn.style.display = 'none';
            profileBtn.style.display = 'none';
            profileMenuLink.style.display = 'none';
            addProductBtn.style.display = 'none';
            document.getElementById('showAddUserBtn').style.display = 'none';
            document.getElementById('showListUsersBtn').style.display = 'none';
            document.getElementById('addUserSection').style.display = 'none';
            document.getElementById('listUsersSection').style.display = 'none';
        }
        document.getElementById('usersSection').style.display = 'none';
        document.getElementById('profileSection').style.display = 'none';
        const productsSections = [
            document.getElementById('food-catalog').parentElement,
            document.getElementById('beers-catalog').parentElement,
            document.getElementById('whiskey-catalog').parentElement,
            document.getElementById('orders'),
            document.querySelector('.order-list')
        ];
        productsSections.forEach(sec => { if (sec) sec.style.display = ''; });
    }

    // Profile button click handler
    document.getElementById('profileBtn').onclick = function() {
        showProfileSection();
    };

    // Profile menu link click handler
    document.getElementById('profileMenuLink').onclick = function() {
        showProfileSection();
    };

    // Back to store from profile
    document.getElementById('backToStoreFromProfileBtn').onclick = function() {
        document.getElementById('profileSection').style.display = 'none';
        // Show all product/order sections
        const productsSections = [
            document.getElementById('food-catalog').parentElement,
            document.getElementById('beers-catalog').parentElement,
            document.getElementById('whiskey-catalog').parentElement,
            document.getElementById('orders'),
            document.querySelector('.order-list')
        ];
        productsSections.forEach(sec => { if (sec) sec.style.display = ''; });
        window.location.hash = '#products';
    };

    function showProfileSection() {
        // Hide all other sections
        const productsSections = [
            document.getElementById('food-catalog').parentElement,
            document.getElementById('beers-catalog').parentElement,
            document.getElementById('whiskey-catalog').parentElement,
            document.getElementById('orders'),
            document.querySelector('.order-list')
        ];
        productsSections.forEach(sec => { if (sec) sec.style.display = 'none'; });
        document.getElementById('usersSection').style.display = 'none';
        
        // Show profile section
        document.getElementById('profileSection').style.display = '';
        
        // Load current user data
        loadUserProfile();
        window.location.hash = '#profile';
    }

    async function loadUserProfile() {
        if (!currentUser) return;
        
        try {
            const res = await fetch(usersApi + '/profile/' + currentUser.id);
            if (res.ok) {
                const userProfile = await res.json();
                document.getElementById('profileUsername').value = userProfile.username || '';
                document.getElementById('profileEmail').value = userProfile.email || '';
                document.getElementById('profilePhone').value = userProfile.phoneNumber || '';
                document.getElementById('profilePassword').value = '';
            }
        } catch (err) {
            showToast('Failed to load profile data', true);
        }
    }

    // Profile update form handler
    document.getElementById('updateProfileForm').onsubmit = async function(e) {
        e.preventDefault();
        
        const username = document.getElementById('profileUsername').value;
        const email = document.getElementById('profileEmail').value;
        const phone = document.getElementById('profilePhone').value;
        const password = document.getElementById('profilePassword').value;
        
        const statusDiv = document.getElementById('profileStatus');
        statusDiv.style.display = 'none';
        
        try {
            const updateData = {
                username: username,
                email: email,
                phoneNumber: phone
            };
            
            // Only include password if provided
            if (password.trim()) {
                updateData.password = password;
            }
            
            const res = await fetch(usersApi + '/profile/' + currentUser.id, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(updateData)
            });
            
            if (res.ok) {
                const updatedUser = await res.json();
                // Update current user data
                currentUser.username = updatedUser.username;
                currentUser.email = updatedUser.email;
                currentUser.phoneNumber = updatedUser.phoneNumber;
                localStorage.setItem('user', JSON.stringify(currentUser));
                
                // Update UI
                updateUserUI();
                
                // Show success message
                statusDiv.style.display = 'block';
                statusDiv.style.background = '#d4edda';
                statusDiv.style.color = '#155724';
                statusDiv.style.border = '1px solid #c3e6cb';
                statusDiv.innerHTML = '✅ Profile updated successfully!';
                
                // Clear password field
                document.getElementById('profilePassword').value = '';
                
                showToast('Profile updated successfully! 🎉');
            } else {
                statusDiv.style.display = 'block';
                statusDiv.style.background = '#f8d7da';
                statusDiv.style.color = '#721c24';
                statusDiv.style.border = '1px solid #f5c6cb';
                statusDiv.innerHTML = '❌ Failed to update profile. Please try again.';
            }
        } catch (err) {
            statusDiv.style.display = 'block';
            statusDiv.style.background = '#f8d7da';
            statusDiv.style.color = '#721c24';
            statusDiv.style.border = '1px solid #f5c6cb';
            statusDiv.innerHTML = '⚠️ Connection failed. Please check if the backend services are running.';
        }
    };

    renderProducts();
    fetchOrders();
    </script>
</body>
</html> 